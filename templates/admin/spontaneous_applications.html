<!DOCTYPE html>
<html lang="{% if lang == 'ar' %}ar{% else %}fr{% endif %}" {% if lang == 'ar' %}dir="rtl"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if lang == 'ar' %}Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙÙˆÙŠØ© - Ø³Ù„Ø³Ø¨ÙŠÙ„{% else %}Candidatures SpontanÃ©es - Admin Salsabil{% endif %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    {% if lang == 'ar' %}
    <style>
        body {
            direction: rtl;
            text-align: right;
        }
        .admin-sidebar {
            right: auto;
            left: 0;
        }
        .admin-main {
            margin-right: 0;
            margin-left: 280px;
        }
        .sidebar-nav .nav-item svg {
            margin-left: 12px;
            margin-right: 0;
        }
        .admin-table th,
        .admin-table td {
            text-align: right;
        }
        .admin-table th:last-child,
        .admin-table td:last-child {
            text-align: left;
        }
        .badge {
            margin-right: auto;
            margin-left: 8px;
        }
        .filter-group input,
        .filter-group select {
            text-align: right;
        }
        .position-tags {
            text-align: right;
        }
    </style>
    {% endif %}
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <img src="{{ url_for('static', filename='img/logo.jpeg') }}" alt="Logo Salsabil" class="logo-img">
                <h3>{% if lang == 'ar' %}Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…{% else %}Admin Panel{% endif %}</h3>
            </div>

            <nav class="sidebar-nav">
                <a href="{{ url_for('admin_dashboard_ar' if lang == 'ar' else 'admin_dashboard') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    {% if lang == 'ar' %}Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…{% else %}Dashboard{% endif %}
                </a>
                <a href="{{ url_for('admin_jobs_ar' if lang == 'ar' else 'admin_jobs') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                    </svg>
                    {% if lang == 'ar' %}Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ù„{% else %}Offres d'emploi{% endif %}
                    {% if jobs|length > 0 %}
                    <span class="badge">{{ jobs|length }}</span>
                    {% endif %}
                </a>
                <a href="{{ url_for('admin_applications_ar' if lang == 'ar' else 'admin_applications') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <polyline points="17 11 19 13 23 9"></polyline>
                    </svg>
                    {% if lang == 'ar' %}Ø§Ù„Ø·Ù„Ø¨Ø§Øª{% else %}Candidatures{% endif %}
                </a>
                <a href="{{ url_for('admin_spontaneous_applications_ar' if lang == 'ar' else 'admin_spontaneous_applications') }}" class="nav-item active">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <path d="M15 8h6m-3-3v6"></path>
                    </svg>
                    {% if lang == 'ar' %}Ø·Ù„Ø¨Ø§Øª Ø¹ÙÙˆÙŠØ©{% else %}Candidatures SpontanÃ©es{% endif %}
                    {% if spontaneous_count > 0 %}
                    <span class="badge">{{ spontaneous_count }}</span>
                    {% endif %}
                </a>
                {% if permissions and permissions.view_employees %}
                <a href="{{ url_for('admin_employees_ar' if lang == 'ar' else 'admin_employees') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    {% if lang == 'ar' %}Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†{% else %}EmployÃ©s{% endif %}
                </a>
                {% endif %}
                <a href="{{ url_for('admin_profile_ar' if lang == 'ar' else 'admin_profile') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    {% if lang == 'ar' %}Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ{% else %}Mon Profil{% endif %}
                </a>
                <a href="{{ url_for('jobs_ar' if lang == 'ar' else 'jobs') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    {% if lang == 'ar' %}Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…{% else %}Site public{% endif %}
                </a>
            </nav>

            <div class="sidebar-footer">
                <!-- Language Switcher -->
                {% if lang == 'ar' %}
                    {% if is_favorites_view %}
                    <a href="{{ url_for('admin_favorite_applications') }}" class="nav-item lang-switch">
                    {% else %}
                    <a href="{{ url_for('admin_spontaneous_applications') }}" class="nav-item lang-switch">
                    {% endif %}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        </svg>
                        FranÃ§ais
                    </a>
                {% else %}
                    {% if is_favorites_view %}
                    <a href="{{ url_for('admin_favorite_applications_ar') }}" class="nav-item lang-switch">
                    {% else %}
                    <a href="{{ url_for('admin_spontaneous_applications_ar') }}" class="nav-item lang-switch">
                    {% endif %}
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        </svg>
                        Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                    </a>
                {% endif %}
                
                <a href="{{ url_for('admin_logout') }}" class="btn-logout">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    {% if lang == 'ar' %}ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬{% else %}DÃ©connexion{% endif %}
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="admin-header">
                <div>
                    {% if is_favorites_view %}
                    <h1>{% if lang == 'ar' %}â­ Ø§Ù„Ù…Ø±Ø´Ø­ÙˆÙ† Ø§Ù„Ù…ÙØ¶Ù„ÙˆÙ†{% else %}â­ Candidats Favoris{% endif %}</h1>
                    <p style="color: #666; margin-top: 0.5rem;">{% if lang == 'ar' %}Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙÙˆÙŠØ© Ø§Ù„Ù…Ù…ÙŠØ²Ø© ÙƒÙ…ÙØ¶Ù„Ø©{% else %}Candidatures spontanÃ©es marquÃ©es comme favorites{% endif %}</p>
                    {% else %}
                    <h1>{% if lang == 'ar' %}ğŸŒŸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙÙˆÙŠØ©{% else %}ğŸŒŸ Candidatures SpontanÃ©es{% endif %}</h1>
                    <p style="color: #666; margin-top: 0.5rem;">{% if lang == 'ar' %}Ø§Ù„Ù…Ø±Ø´Ø­ÙˆÙ† Ø§Ù„Ø°ÙŠÙ† ØªÙ‚Ø¯Ù…ÙˆØ§ Ø¨Ø¯ÙˆÙ† Ø¹Ø±Ø¶ Ù…Ø­Ø¯Ø¯{% else %}Candidats ayant postulÃ© sans offre spÃ©cifique{% endif %}</p>
                    {% endif %}
                </div>
                <div class="admin-user">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>{{ current_user.prenom if current_user else 'Admin' }} {{ current_user.nom if current_user else '' }}</span>
                    {% if current_user and current_user.role %}
                    <span class="user-role">({{ current_user.role|capitalize }})</span>
                    {% endif %}
                </div>
            </div>

            <!-- Spontaneous Applications Toggle Control -->
            {% if not is_favorites_view %}
            <div class="spontaneous-status-control" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
                    <div>
                        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;">
                            {% if lang == 'ar' %}
                                Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙÙˆÙŠØ©
                            {% else %}
                                Statut des candidatures spontanÃ©es
                            {% endif %}
                        </h3>
                        {% if spontaneous_open %}
                            <div style="display: flex; align-items: center; gap: 0.5rem; color: #10b981;">
                                <span style="font-size: 1.5rem;">ğŸ”“</span>
                                <strong>
                                    {% if lang == 'ar' %}
                                        Ù…ÙØªÙˆØ­Ø© Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±
                                    {% else %}
                                        Ouvertes au public
                                    {% endif %}
                                </strong>
                            </div>
                            <p style="margin: 0.5rem 0 0 0; color: #666; font-size: 0.9rem;">
                                {% if lang == 'ar' %}
                                    ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø±Ø´Ø­ÙŠÙ† ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ø§Øª Ø¹ÙÙˆÙŠØ©
                                {% else %}
                                    Les candidats peuvent soumettre des candidatures spontanÃ©es
                                {% endif %}
                            </p>
                        {% else %}
                            <div style="display: flex; align-items: center; gap: 0.5rem; color: #f59e0b;">
                                <span style="font-size: 1.5rem;">ğŸ”’</span>
                                <strong>
                                    {% if lang == 'ar' %}
                                        Ù…ØºÙ„Ù‚Ø© Ù…Ø¤Ù‚ØªØ§Ù‹
                                    {% else %}
                                        FermÃ©es temporairement
                                    {% endif %}
                                </strong>
                            </div>
                            <p style="margin: 0.5rem 0 0 0; color: #666; font-size: 0.9rem;">
                                {% if lang == 'ar' %}
                                    Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ø§Øª Ø¹ÙÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
                                {% else %}
                                    Les nouvelles candidatures spontanÃ©es sont bloquÃ©es
                                {% endif %}
                            </p>
                        {% endif %}
                    </div>
                    
                    <form method="POST" action="{{ url_for('admin_toggle_spontaneous') }}" style="margin: 0;">
                        {% if spontaneous_open %}
                            <button type="submit" class="btn" style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s;">
                                <span>ğŸ”’</span>
                                {% if lang == 'ar' %}
                                    Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¤Ù‚ØªØ§Ù‹
                                {% else %}
                                    Fermer temporairement
                                {% endif %}
                            </button>
                        {% else %}
                            <button type="submit" class="btn" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s;">
                                <span>ğŸ”“</span>
                                {% if lang == 'ar' %}
                                    Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                                {% else %}
                                    Rouvrir les candidatures
                                {% endif %}
                            </button>
                        {% endif %}
                    </form>
                </div>
            </div>
            {% endif %}

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <path d="M15 8h6m-3-3v6"></path>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <h3>{{ applications|length }}</h3>
                        <p>{% if lang == 'ar' %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙÙˆÙŠØ©{% else %}Total candidatures spontanÃ©es{% endif %}</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon green">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <h3>{{ applications|selectattr('status', 'equalto', 'acceptÃ©e')|list|length }}</h3>
                        <p>{% if lang == 'ar' %}Ù…Ù‚Ø¨ÙˆÙ„{% else %}AcceptÃ©es{% endif %}</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon orange">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <h3>{{ applications|selectattr('status', 'equalto', 'en attente')|list|length }}</h3>
                        <p>{% if lang == 'ar' %}Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±{% else %}En attente{% endif %}</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon purple">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="#FFD700" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <h3>{{ applications|selectattr('is_favorite', 'equalto', 1)|list|length }}</h3>
                        <p>{% if lang == 'ar' %}Ø§Ù„Ù…Ø±Ø´Ø­ÙˆÙ† Ø§Ù„Ù…ÙØ¶Ù„ÙˆÙ†{% else %}Candidats favoris{% endif %}</p>
                    </div>
                </div>
            </div>

            <!-- Toggle Favorites Button -->
            <div style="margin-bottom: 1.5rem; margin-top: 2rem;">
                {% if is_favorites_view %}
                <a href="{{ url_for('admin_spontaneous_applications_ar' if lang == 'ar' else 'admin_spontaneous_applications') }}" class="btn-toggle-favorites">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <path d="M15 8h6m-3-3v6"></path>
                    </svg>
                    <span>{% if lang == 'ar' %}Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙÙˆÙŠØ©{% else %}Voir toutes les candidatures spontanÃ©es{% endif %}</span>
                </a>
                {% else %}
                <a href="{{ url_for('admin_favorite_applications_ar' if lang == 'ar' else 'admin_favorite_applications') }}" class="btn-toggle-favorites">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#FFD700" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    <span>{% if lang == 'ar' %}Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¶Ù„ÙŠÙ† ÙÙ‚Ø·{% else %}Voir uniquement les favoris{% endif %}</span>
                </a>
                {% endif %}
            </div>

            <!-- Filters -->
            <div class="filters-bar">
                <div class="filter-group">
                    <label>{% if lang == 'ar' %}ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©:{% else %}Filtrer par statut:{% endif %}</label>
                    <select id="statusFilter" onchange="filterApplications()">
                        <option value="all">{% if lang == 'ar' %}Ø§Ù„ÙƒÙ„{% else %}Tous{% endif %}</option>
                        <option value="en-attente">{% if lang == 'ar' %}Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±{% else %}En attente{% endif %}</option>
                        <option value="acceptÃ©e">{% if lang == 'ar' %}Ù…Ù‚Ø¨ÙˆÙ„{% else %}AcceptÃ©e{% endif %}</option>
                        <option value="rejetÃ©e">{% if lang == 'ar' %}Ù…Ø±ÙÙˆØ¶{% else %}RejetÃ©e{% endif %}</option>
                    </select>
                </div>
                <div class="search-box">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="searchInput" placeholder="{% if lang == 'ar' %}Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±Ø´Ø­...{% else %}Rechercher un candidat...{% endif %}" onkeyup="searchApplications()">
                </div>
                <button class="btn-advanced-filters" onclick="toggleAdvancedFilters()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                    {% if lang == 'ar' %}ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø©{% else %}Filtres avancÃ©s{% endif %}
                </button>
            </div>

            <!-- Advanced Filters Panel -->
            <div id="advancedFiltersPanel" class="advanced-filters-panel" style="display: none;">
                <div class="filters-grid">
                    <!-- RÃ©gion Filter -->
                    <div class="filter-item">
                        <label for="regionFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            {% if lang == 'ar' %}Ø§Ù„Ù…Ù†Ø·Ù‚Ø©{% else %}RÃ©gion{% endif %}
                        </label>
                        <select id="regionFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}ÙƒÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚{% else %}Toutes les rÃ©gions{% endif %}</option>
                            <optgroup label="{% if lang == 'ar' %}Ø§Ù„Ù‚Ù…Ø± Ø§Ù„ÙƒØ¨Ø±Ù‰{% else %}Grande Comore{% endif %}">
                                <option value="Bambao">Bambao</option>
                                <option value="Hambou">Hambou</option>
                                <option value="Hamahamet">Hamahamet</option>
                                <option value="Itsandra">Itsandra</option>
                                <option value="Mitsamiouli">Mitsamiouli</option>
                                <option value="Moroni">Moroni</option>
                                <option value="Oichili">Oichili</option>
                                <option value="Dimani">Dimani</option>
                                <option value="Tsingoni">Mboikou</option>
                                <option value="MboudÃ©">MboudÃ©</option>
                            </optgroup>
                            <optgroup label="Anjouan">
                                <option value="Domoni">Domoni</option>
                                <option value="Mutsamudu">Mutsamudu</option>
                                <option value="Ouani">Ouani</option>
                                <option value="Sima">Sima</option>
                                <option value="Adda-DouÃ©ni">Adda-DouÃ©ni</option>
                                <option value="Barakani">Barakani</option>
                                <option value="Koni-Djodjo">NoumakÃ©lÃ©</option>
                                <option value="Moya">Moya</option>
                                <option value="Nioumachoua">Nioumachoua (Anjouan)</option>
                                <option value="Pomoni">Pomoni</option>
                                <option value="Tsembehou">Tsembehou</option>
                            </optgroup>
                            <optgroup label="MohÃ©li">
                                <option value="Fomboni">Fomboni</option>
                                <option value="Djando">Djando</option>
                                <option value="Hoani">Hoani</option>
                                <option value="Nioumachoua">Nioumachoua (MohÃ©li)</option>
                                <option value="Ouallah">Ouallah</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- Age Range Filter -->
                    <div class="filter-item">
                        <label for="ageFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            {% if lang == 'ar' %}Ø§Ù„Ø¹Ù…Ø±{% else %}Ã‚ge{% endif %}
                        </label>
                        <select id="ageFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}ÙƒÙ„ Ø§Ù„Ø£Ø¹Ù…Ø§Ø±{% else %}Tous les Ã¢ges{% endif %}</option>
                            <option value="18-25">{% if lang == 'ar' %}18-25 Ø³Ù†Ø©{% else %}18-25 ans{% endif %}</option>
                            <option value="26-35">{% if lang == 'ar' %}26-35 Ø³Ù†Ø©{% else %}26-35 ans{% endif %}</option>
                            <option value="36-45">{% if lang == 'ar' %}36-45 Ø³Ù†Ø©{% else %}36-45 ans{% endif %}</option>
                            <option value="46-55">{% if lang == 'ar' %}46-55 Ø³Ù†Ø©{% else %}46-55 ans{% endif %}</option>
                            <option value="56+">{% if lang == 'ar' %}56+ Ø³Ù†Ø©{% else %}56+ ans{% endif %}</option>
                        </select>
                    </div>

                    <!-- DÃ©partement Filter -->
                    <div class="filter-item">
                        <label for="departmentFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                            </svg>
                            {% if lang == 'ar' %}Ø§Ù„Ù‚Ø³Ù…{% else %}DÃ©partement{% endif %}
                        </label>
                        <select id="departmentFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…{% else %}Tous les dÃ©partements{% endif %}</option>
                            <option value="production">{% if lang == 'ar' %}1ï¸âƒ£ Ù‚Ø³Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬{% else %}1ï¸âƒ£ DÃ©partement de la production{% endif %}</option>
                            <option value="entrepots">{% if lang == 'ar' %}2ï¸âƒ£ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ©{% else %}2ï¸âƒ£ EntrepÃ´ts et logistique{% endif %}</option>
                            <option value="achats">{% if lang == 'ar' %}3ï¸âƒ£ ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª{% else %}3ï¸âƒ£ UnitÃ© des achats{% endif %}</option>
                            <option value="administratif">{% if lang == 'ar' %}4ï¸âƒ£ Ø¥Ø¯Ø§Ø±ÙŠ ÙˆÙ…Ø­Ø§Ø³Ø¨ÙŠ{% else %}4ï¸âƒ£ Administratif et comptable{% endif %}</option>
                            <option value="sante">{% if lang == 'ar' %}5ï¸âƒ£ Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©{% else %}5ï¸âƒ£ SantÃ©, sÃ©curitÃ© et qualitÃ©{% endif %}</option>
                            <option value="marketing">{% if lang == 'ar' %}6ï¸âƒ£ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª{% else %}6ï¸âƒ£ Marketing et ventes{% endif %}</option>
                            <option value="maintenance">{% if lang == 'ar' %}7ï¸âƒ£ Ø§Ù„ØµÙŠØ§Ù†Ø©{% else %}7ï¸âƒ£ Maintenance{% endif %}</option>
                            <option value="qualite">{% if lang == 'ar' %}8ï¸âƒ£ Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø±Ù‚Ø§Ø¨Ø©{% else %}8ï¸âƒ£ QualitÃ© et contrÃ´le{% endif %}</option>
                            <option value="it">{% if lang == 'ar' %}9ï¸âƒ£ ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª{% else %}9ï¸âƒ£ IT (Technologies de l'information){% endif %}</option>
                        </select>
                    </div>

                    <!-- Choix de Travail Filter -->
                    <div class="filter-item">
                        <label for="workChoiceFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                            </svg>
                            {% if lang == 'ar' %}Ù…Ù†ØµØ¨ Ù…Ø­Ø¯Ø¯{% else %}Poste spÃ©cifique{% endif %}
                        </label>
                        <select id="workChoiceFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}ÙƒÙ„ Ø§Ù„Ù…Ù†Ø§ØµØ¨{% else %}Tous les postes{% endif %}</option>
                            <optgroup label="{% if lang == 'ar' %}ğŸ­ Ø§Ù„Ø¥Ù†ØªØ§Ø¬{% else %}ğŸ­ Production{% endif %}">
                                <option value="Chef du dÃ©partement de production">Chef du dÃ©partement de production</option>
                                <option value="Responsable de production">Responsable de production</option>
                                <option value="Superviseur de ligne de production">Superviseur de ligne de production</option>
                                <option value="Chef d'Ã©quipe de production">Chef d'Ã©quipe de production</option>
                                <option value="OpÃ©rateur de machine">OpÃ©rateur de machine</option>
                                <option value="Technicien de production">Technicien de production</option>
                                <option value="Ouvrier de production">Ouvrier de production</option>
                                <option value="ContrÃ´leur de production">ContrÃ´leur de production</option>
                            </optgroup>
                            <optgroup label="ğŸ“¦ EntrepÃ´ts et logistique">
                                <option value="Responsable des entrepÃ´ts">Responsable des entrepÃ´ts</option>
                                <option value="Chef magasinier">Chef magasinier</option>
                                <option value="Magasinier / Gestionnaire de stock">Magasinier / Gestionnaire de stock</option>
                                <option value="OpÃ©rateur logistique">OpÃ©rateur logistique</option>
                                <option value="Cariste / Conducteur de chariot Ã©lÃ©vateur">Cariste / Conducteur de chariot Ã©lÃ©vateur</option>
                                <option value="PrÃ©parateur de commandes">PrÃ©parateur de commandes</option>
                                <option value="Agent d'expÃ©dition / rÃ©ception">Agent d'expÃ©dition / rÃ©ception</option>
                            </optgroup>
                            <optgroup label="ğŸ›’ UnitÃ© des achats">
                                <option value="Superviseur des achats">Superviseur des achats</option>
                                <option value="Responsable des achats locaux">Responsable des achats locaux</option>
                                <option value="Responsable des achats locaux et administratifs">Responsable des achats locaux et administratifs</option>
                                <option value="Agent de suivi des livraisons">Agent de suivi des livraisons</option>
                                <option value="ContrÃ´leur ou analyste des achats">ContrÃ´leur ou analyste des achats</option>
                            </optgroup>
                            <optgroup label="ğŸ’¼ Administratif et comptable">
                                <option value="Comptable">Comptable</option>
                                <option value="Assistant comptable">Assistant comptable</option>
                                <option value="ContrÃ´leur financier">ContrÃ´leur financier</option>
                                <option value="SecrÃ©taire / Assistant administratif">SecrÃ©taire / Assistant administratif</option>
                                <option value="Gestionnaire de paie">Gestionnaire de paie</option>
                                <option value="Responsable des ressources humaines (RH)">Responsable des ressources humaines (RH)</option>
                            </optgroup>
                            <optgroup label="ğŸ›¡ï¸ SantÃ©, sÃ©curitÃ© et qualitÃ©">
                                <option value="Directeur santÃ© et sÃ©curitÃ© au travail">Directeur santÃ© et sÃ©curitÃ© au travail</option>
                                <option value="Responsable hygiÃ¨ne, sÃ©curitÃ© et environnement (HSE)">Responsable hygiÃ¨ne, sÃ©curitÃ© et environnement (HSE)</option>
                                <option value="Chef HSE">Chef HSE</option>
                                <option value="Agent HSE">Agent HSE</option>
                                <option value="IngÃ©nieur sÃ©curitÃ©">IngÃ©nieur sÃ©curitÃ©</option>
                                <option value="Technicien en hygiÃ¨ne et sÃ©curitÃ©">Technicien en hygiÃ¨ne et sÃ©curitÃ©</option>
                                <option value="Responsable qualitÃ©">Responsable qualitÃ©</option>
                                <option value="Auditeur qualitÃ© interne">Auditeur qualitÃ© interne</option>
                                <option value="ContrÃ´leur de sÃ©curitÃ©">ContrÃ´leur de sÃ©curitÃ©</option>
                                <option value="Secouriste industriel / Technicien de premiers secours">Secouriste industriel / Technicien de premiers secours</option>
                            </optgroup>
                            <optgroup label="ğŸ“¢ Marketing et ventes">
                                <option value="Responsable marketing">Responsable marketing</option>
                                <option value="Chef de produit">Chef de produit</option>
                                <option value="ChargÃ© de communication">ChargÃ© de communication</option>
                                <option value="Commercial / Vendeur">Commercial / Vendeur</option>
                                <option value="Assistant marketing">Assistant marketing</option>
                                <option value="Responsable relations clients">Responsable relations clients</option>
                            </optgroup>
                            <optgroup label="ï¿½ Maintenance">
                                <option value="Responsable maintenance">Responsable maintenance</option>
                                <option value="Technicien de maintenance industrielle">Technicien de maintenance industrielle</option>
                                <option value="Ã‰lectricien industriel">Ã‰lectricien industriel</option>
                                <option value="MÃ©canicien industriel">MÃ©canicien industriel</option>
                                <option value="Automaticien / Technicien en automatisme">Automaticien / Technicien en automatisme</option>
                                <option value="Technicien frigoriste">Technicien frigoriste</option>
                                <option value="Soudeur industriel">Soudeur industriel</option>
                                <option value="Plombier industriel">Plombier industriel</option>
                                <option value="Chaudronnier">Chaudronnier</option>
                                <option value="Technicien en instrumentation">Technicien en instrumentation</option>
                                <option value="Technicien des pompes et systÃ¨mes d'eau">Technicien des pompes et systÃ¨mes d'eau</option>
                            </optgroup>
                            <optgroup label="âœ… QualitÃ© et contrÃ´le">
                                <option value="Responsable contrÃ´le qualitÃ©">Responsable contrÃ´le qualitÃ©</option>
                                <option value="Technicien de contrÃ´le qualitÃ©">Technicien de contrÃ´le qualitÃ©</option>
                                <option value="ContrÃ´leur qualitÃ© produits">ContrÃ´leur qualitÃ© produits</option>
                                <option value="Analyste qualitÃ©">Analyste qualitÃ©</option>
                                <option value="SpÃ©cialiste en sÃ©curitÃ© alimentaire">SpÃ©cialiste en sÃ©curitÃ© alimentaire</option>
                                <option value="Technicien de laboratoire (analyse de l'eau)">Technicien de laboratoire (analyse de l'eau)</option>
                                <option value="Inspecteur qualitÃ©">Inspecteur qualitÃ©</option>
                            </optgroup>
                            <optgroup label="ï¿½ IT (Technologies de l'information)">
                                <option value="Responsable IT / Directeur des systÃ¨mes d'information">Responsable IT / Directeur des systÃ¨mes d'information</option>
                                <option value="DÃ©veloppeur / IngÃ©nieur logiciel">DÃ©veloppeur / IngÃ©nieur logiciel</option>
                                <option value="Administrateur rÃ©seau et systÃ¨mes">Administrateur rÃ©seau et systÃ¨mes</option>
                                <option value="Technicien support informatique">Technicien support informatique</option>
                                <option value="SpÃ©cialiste cybersÃ©curitÃ©">SpÃ©cialiste cybersÃ©curitÃ©</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- Langue Arabe Filter -->
                    <div class="filter-item">
                        <label for="arabicFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                            {% if lang == 'ar' %}Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©{% else %}Langue Arabe{% endif %}
                        </label>
                        <select id="arabicFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª{% else %}Tous niveaux{% endif %}</option>
                            <option value="Faible">{% if lang == 'ar' %}Ø¶Ø¹ÙŠÙ{% else %}Faible{% endif %}</option>
                            <option value="Bon">{% if lang == 'ar' %}Ø¬ÙŠØ¯{% else %}Bon{% endif %}</option>
                            <option value="TrÃ¨s bon">{% if lang == 'ar' %}Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹{% else %}TrÃ¨s bon{% endif %}</option>
                            <option value="Excellent">{% if lang == 'ar' %}Ù…Ù…ØªØ§Ø²{% else %}Excellent{% endif %}</option>
                            <option value="Non maÃ®trisÃ©e">{% if lang == 'ar' %}ØºÙŠØ± Ù…ØªÙ‚Ù†{% else %}Non maÃ®trisÃ©e{% endif %}</option>
                        </select>
                    </div>

                    <!-- Langue FranÃ§aise Filter -->
                    <div class="filter-item">
                        <label for="frenchFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                            {% if lang == 'ar' %}Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©{% else %}Langue FranÃ§aise{% endif %}
                        </label>
                        <select id="frenchFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª{% else %}Tous niveaux{% endif %}</option>
                            <option value="A1 / A2 : DÃ©butant">{% if lang == 'ar' %}A1 / A2 : Ù…Ø¨ØªØ¯Ø¦{% else %}A1 / A2 : DÃ©butant{% endif %}</option>
                            <option value="B1 / B2 : IntermÃ©diaire">{% if lang == 'ar' %}B1 / B2 : Ù…ØªÙˆØ³Ø·{% else %}B1 / B2 : IntermÃ©diaire{% endif %}</option>
                            <option value="C1 / C2 : AvancÃ©">{% if lang == 'ar' %}C1 / C2 : Ù…ØªÙ‚Ø¯Ù…{% else %}C1 / C2 : AvancÃ©{% endif %}</option>
                        </select>
                    </div>

                    <!-- Langue Anglaise Filter -->
                    <div class="filter-item">
                        <label for="englishFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                            {% if lang == 'ar' %}Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©{% else %}Langue Anglaise{% endif %}
                        </label>
                        <select id="englishFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª{% else %}Tous niveaux{% endif %}</option>
                            <option value="A1 / A2 : DÃ©butant">{% if lang == 'ar' %}A1 / A2 : Ù…Ø¨ØªØ¯Ø¦{% else %}A1 / A2 : DÃ©butant{% endif %}</option>
                            <option value="B1 / B2 : IntermÃ©diaire">{% if lang == 'ar' %}B1 / B2 : Ù…ØªÙˆØ³Ø·{% else %}B1 / B2 : IntermÃ©diaire{% endif %}</option>
                            <option value="C1 / C2 : AvancÃ©">{% if lang == 'ar' %}C1 / C2 : Ù…ØªÙ‚Ø¯Ù…{% else %}C1 / C2 : AvancÃ©{% endif %}</option>
                        </select>
                    </div>

                    <!-- Sexe Filter -->
                    <div class="filter-item">
                        <label for="sexeFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            {% if lang == 'ar' %}Ø§Ù„Ø¬Ù†Ø³{% else %}Sexe{% endif %}
                        </label>
                        <select id="sexeFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}Ø°ÙƒØ± ÙˆØ£Ù†Ø«Ù‰{% else %}Masculin & FÃ©minin{% endif %}</option>
                            <option value="Masculin">{% if lang == 'ar' %}Ø°ÙƒØ±{% else %}Masculin{% endif %}</option>
                            <option value="FÃ©minin">{% if lang == 'ar' %}Ø£Ù†Ø«Ù‰{% else %}FÃ©minin{% endif %}</option>
                        </select>
                    </div>

                    <!-- Niveau d'instruction Filter -->
                    <div class="filter-item">
                        <label for="educationFilter">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                                <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                            </svg>
                            {% if lang == 'ar' %}Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ{% else %}Niveau d'instruction{% endif %}
                        </label>
                        <select id="educationFilter" onchange="filterApplications()">
                            <option value="all">{% if lang == 'ar' %}ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª{% else %}Tous niveaux{% endif %}</option>
                            <option value="Aucun">{% if lang == 'ar' %}Ù„Ø§ Ø´ÙŠØ¡{% else %}Aucun{% endif %}</option>
                            <option value="Primaire">{% if lang == 'ar' %}Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ{% else %}Primaire{% endif %}</option>
                            <option value="Secondaire">{% if lang == 'ar' %}Ø«Ø§Ù†ÙˆÙŠ{% else %}Secondaire{% endif %}</option>
                            <option value="BaccalaurÃ©at">{% if lang == 'ar' %}Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§{% else %}BaccalaurÃ©at{% endif %}</option>
                            <option value="DiplÃ´me d'institut">{% if lang == 'ar' %}Ø¯Ø¨Ù„ÙˆÙ… Ù…Ø¹Ù‡Ø¯{% else %}DiplÃ´me d'institut{% endif %}</option>
                        </select>
                    </div>
                </div>

                <div class="filters-actions">
                    <button class="btn-reset-filters" onclick="resetFilters()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <polyline points="23 20 23 14 17 14"></polyline>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                        </svg>
                        {% if lang == 'ar' %}Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±{% else %}RÃ©initialiser les filtres{% endif %}
                    </button>
                    <span id="resultsCount" class="results-count"></span>
                </div>
            </div>

            <!-- Applications List -->
            <div class="content-section">
                {% if applications %}
                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;">â­</th>
                                <th>{% if lang == 'ar' %}Ø§Ù„Ù…Ø±Ø´Ø­{% else %}Candidat{% endif %}</th>
                                <th>{% if lang == 'ar' %}Ø§Ù„Ù‡Ø§ØªÙ{% else %}TÃ©lÃ©phone{% endif %}</th>
                                <th>{% if lang == 'ar' %}Ø§Ù„Ø¹Ù†ÙˆØ§Ù†{% else %}Adresse{% endif %}</th>
                                <th>{% if lang == 'ar' %}ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…{% else %}Date de soumission{% endif %}</th>
                                <th>{% if lang == 'ar' %}Ø§Ù„Ø­Ø§Ù„Ø©{% else %}Statut{% endif %}</th>
                                <th>{% if lang == 'ar' %}Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª{% else %}Actions{% endif %}</th>
                            </tr>
                        </thead>
                        <tbody id="applicationsTable">
                            {% for app in applications %}
                            <tr data-status="{{ app.status.replace(' ', '-') }}" 
                                data-name="{{ app.prenom }} {{ app.nom }}"
                                data-region="{{ app.region if app.region else '' }}"
                                data-birthdate="{{ app.date_naissance if app.date_naissance else '' }}"
                                data-workchoice="{{ app.choix_travail if app.choix_travail else '' }}"
                                data-arabic="{{ app.langue_arabe if app.langue_arabe else '' }}"
                                data-french="{{ app.langue_francaise if app.langue_francaise else '' }}"
                                data-english="{{ app.langue_anglaise if app.langue_anglaise else '' }}"
                                data-sexe="{{ app.sexe if app.sexe else '' }}"
                                data-education="{{ app.niveau_instruction if app.niveau_instruction else '' }}">
                                <td style="text-align: center;">
                                    <form action="{{ url_for('admin_toggle_favorite', app_id=app.id) }}" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-favorite {{ 'active' if app.is_favorite == 1 else '' }}" title="{{ 'Retirer des favoris' if app.is_favorite == 1 else 'Ajouter aux favoris' }}">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="{{ '#FFD700' if app.is_favorite == 1 else 'none' }}" stroke="currentColor" stroke-width="2">
                                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                            </svg>
                                        </button>
                                    </form>
                                </td>
                                <td>
                                    <div class="candidate-info">
                                        <div class="candidate-avatar" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                                            {{ app.prenom[0] }}{{ app.nom[0] }}
                                        </div>
                                        <div>
                                            <div class="candidate-name">{{ app.prenom }} {{ app.nom }}</div>
                                            <div class="candidate-email">{{ app.email }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ app.telephone }}</td>
                                <td>{{ app.adresse if app.adresse else '-' }}</td>
                                <td>{{ app.date_soumission }}</td>
                                <td>
                                    <span class="status-badge status-{{ app.status.replace(' ', '-') }}">
                                        {% if lang == 'ar' %}
                                            {% if app.status == 'en attente' %}Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                                            {% elif app.status == 'acceptÃ©e' %}Ù…Ù‚Ø¨ÙˆÙ„
                                            {% elif app.status == 'rejetÃ©e' %}Ù…Ø±ÙÙˆØ¶
                                            {% else %}{{ app.status }}{% endif %}
                                        {% else %}
                                            {{ app.status }}
                                        {% endif %}
                                    </span>
                                </td>
                                <td>
                                    <a href="{{ url_for('admin_spontaneous_application_detail_ar' if lang == 'ar' else 'admin_spontaneous_application_detail', app_id=app.id) }}?v=2" class="btn-view" title="{% if lang == 'ar' %}Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„{% else %}Voir les dÃ©tails{% endif %}">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                        {% if lang == 'ar' %}Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„{% else %}Voir dÃ©tails{% endif %}
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    {% if is_favorites_view %}
                    <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    <h3>{% if lang == 'ar' %}Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±Ø´Ø­ÙˆÙ† Ù…ÙØ¶Ù„ÙˆÙ†{% else %}Aucun candidat favori{% endif %}</h3>
                    <p>{% if lang == 'ar' %}Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¬Ù…Ø© â­ Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† ÙƒÙ…ÙØ¶Ù„ÙŠÙ†{% else %}Cliquez sur l'Ã©toile â­ pour marquer des candidats comme favoris{% endif %}</p>
                    <a href="{{ url_for('admin_spontaneous_applications_ar' if lang == 'ar' else 'admin_spontaneous_applications') }}" style="margin-top: 1rem; display: inline-block; color: #667eea; text-decoration: none; font-weight: 500;">
                        â†’ {% if lang == 'ar' %}Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙÙˆÙŠØ©{% else %}Voir toutes les candidatures spontanÃ©es{% endif %}
                    </a>
                    {% else %}
                    <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <path d="M15 8h6m-3-3v6"></path>
                    </svg>
                    <h3>{% if lang == 'ar' %}Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¹ÙÙˆÙŠØ©{% else %}Aucune candidature spontanÃ©e{% endif %}</h3>
                    <p>{% if lang == 'ar' %}Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹ÙÙˆÙŠØ© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ù‡Ù†Ø§{% else %}Les candidatures spontanÃ©es soumises apparaÃ®tront ici{% endif %}</p>
                    <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                        ğŸ’¡ {% if lang == 'ar' %}ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø±Ø´Ø­ÙŠÙ† Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹ÙÙˆÙŠØ§Ù‹ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· "Ø·Ù„Ø¨ Ø¹ÙÙˆÙŠ" Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…{% else %}Les candidats peuvent postuler en candidature spontanÃ©e via le lien "Candidature SpontanÃ©e" sur le site public{% endif %}
                    </p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </main>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        {{ message }}
                        <button onclick="this.parentElement.style.display='none'">&times;</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <script>
        // Toggle Advanced Filters Panel
        function toggleAdvancedFilters() {
            const panel = document.getElementById('advancedFiltersPanel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                // Smooth animation
                setTimeout(() => {
                    panel.style.opacity = '1';
                    panel.style.transform = 'translateY(0)';
                }, 10);
            } else {
                panel.style.opacity = '0';
                panel.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    panel.style.display = 'none';
                }, 300);
            }
        }

        // Calculate age from birthdate
        function calculateAge(birthdate) {
            if (!birthdate) return null;
            const today = new Date();
            const birthDate = new Date(birthdate);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        // Check if age is in range
        function isAgeInRange(birthdate, range) {
            const age = calculateAge(birthdate);
            if (age === null) return false;
            
            switch(range) {
                case '18-25': return age >= 18 && age <= 25;
                case '26-35': return age >= 26 && age <= 35;
                case '36-45': return age >= 36 && age <= 45;
                case '46-55': return age >= 46 && age <= 55;
                case '56+': return age >= 56;
                default: return true;
            }
        }

        // Department mapping for filtering
        const departmentKeywords = {
            'production': ['Chef du dÃ©partement de production', 'Responsable de production', 'Superviseur de ligne de production', 'Chef d\'Ã©quipe de production', 'OpÃ©rateur de machine', 'Technicien de production', 'Ouvrier de production', 'ContrÃ´leur de production'],
            'entrepots': ['Responsable des entrepÃ´ts', 'Chef magasinier', 'Magasinier / Gestionnaire de stock', 'OpÃ©rateur logistique', 'Cariste / Conducteur de chariot Ã©lÃ©vateur', 'PrÃ©parateur de commandes', 'Agent d\'expÃ©dition / rÃ©ception'],
            'achats': ['Superviseur des achats', 'Responsable des achats locaux', 'Responsable des achats locaux et administratifs', 'Agent de suivi des livraisons', 'ContrÃ´leur ou analyste des achats'],
            'administratif': ['Comptable', 'Assistant comptable', 'ContrÃ´leur financier', 'SecrÃ©taire / Assistant administratif', 'Gestionnaire de paie', 'Responsable des ressources humaines (RH)'],
            'sante': ['Directeur santÃ© et sÃ©curitÃ© au travail', 'Responsable hygiÃ¨ne, sÃ©curitÃ© et environnement (HSE)', 'Chef HSE', 'Agent HSE', 'IngÃ©nieur sÃ©curitÃ©', 'Technicien en hygiÃ¨ne et sÃ©curitÃ©', 'Responsable qualitÃ©', 'Auditeur qualitÃ© interne', 'ContrÃ´leur de sÃ©curitÃ©', 'Secouriste industriel / Technicien de premiers secours'],
            'marketing': ['Responsable marketing', 'Chef de produit', 'ChargÃ© de communication', 'Commercial / Vendeur', 'Assistant marketing', 'Responsable relations clients'],
            'maintenance': ['Responsable maintenance', 'Technicien de maintenance industrielle', 'Ã‰lectricien industriel', 'MÃ©canicien industriel', 'Automaticien / Technicien en automatisme', 'Technicien frigoriste', 'Soudeur industriel', 'Plombier industriel', 'Chaudronnier', 'Technicien en instrumentation', 'Technicien des pompes et systÃ¨mes d\'eau'],
            'qualite': ['Responsable contrÃ´le qualitÃ©', 'Technicien de contrÃ´le qualitÃ©', 'ContrÃ´leur qualitÃ© produits', 'Analyste qualitÃ©', 'SpÃ©cialiste en sÃ©curitÃ© alimentaire', 'Technicien de laboratoire (analyse de l\'eau)', 'Inspecteur qualitÃ©'],
            'it': ['Responsable IT / Directeur des systÃ¨mes d\'information', 'DÃ©veloppeur / IngÃ©nieur logiciel', 'Administrateur rÃ©seau et systÃ¨mes', 'Technicien support informatique', 'SpÃ©cialiste cybersÃ©curitÃ©']
        };

        // Main filter function
        function filterApplications() {
            const statusFilter = document.getElementById('statusFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const regionFilter = document.getElementById('regionFilter') ? document.getElementById('regionFilter').value : 'all';
            const ageFilter = document.getElementById('ageFilter') ? document.getElementById('ageFilter').value : 'all';
            const departmentFilter = document.getElementById('departmentFilter') ? document.getElementById('departmentFilter').value : 'all';
            const workChoiceFilter = document.getElementById('workChoiceFilter') ? document.getElementById('workChoiceFilter').value : 'all';
            const arabicFilter = document.getElementById('arabicFilter') ? document.getElementById('arabicFilter').value : 'all';
            const frenchFilter = document.getElementById('frenchFilter') ? document.getElementById('frenchFilter').value : 'all';
            const englishFilter = document.getElementById('englishFilter') ? document.getElementById('englishFilter').value : 'all';
            const sexeFilter = document.getElementById('sexeFilter') ? document.getElementById('sexeFilter').value : 'all';
            const educationFilter = document.getElementById('educationFilter') ? document.getElementById('educationFilter').value : 'all';
            
            const rows = document.querySelectorAll('#applicationsTable tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const status = row.dataset.status;
                const name = row.dataset.name.toLowerCase();
                const region = row.dataset.region;
                const birthdate = row.dataset.birthdate;
                const workChoice = row.dataset.workchoice || '';
                const arabic = row.dataset.arabic || '';
                const french = row.dataset.french || '';
                const english = row.dataset.english || '';
                const sexe = row.dataset.sexe || '';
                const education = row.dataset.education || '';
                
                // Apply all filters
                let showRow = true;
                
                // Status filter
                if (statusFilter !== 'all' && status !== statusFilter) {
                    showRow = false;
                }
                
                // Search filter
                if (searchInput && !name.includes(searchInput)) {
                    showRow = false;
                }
                
                // Region filter
                if (regionFilter !== 'all' && region !== regionFilter) {
                    showRow = false;
                }
                
                // Age filter
                if (ageFilter !== 'all' && !isAgeInRange(birthdate, ageFilter)) {
                    showRow = false;
                }
                
                // Department filter - check if any of the candidate's work choices match the department
                if (departmentFilter !== 'all') {
                    const deptPositions = departmentKeywords[departmentFilter] || [];
                    const hasMatchingPosition = deptPositions.some(position => workChoice.includes(position));
                    if (!hasMatchingPosition) {
                        showRow = false;
                    }
                }
                
                // Work choice filter - specific position
                if (workChoiceFilter !== 'all' && !workChoice.includes(workChoiceFilter)) {
                    showRow = false;
                }
                
                // Arabic filter
                if (arabicFilter !== 'all' && arabic !== arabicFilter) {
                    showRow = false;
                }
                
                // French filter
                if (frenchFilter !== 'all' && french !== frenchFilter) {
                    showRow = false;
                }
                
                // English filter
                if (englishFilter !== 'all' && english !== englishFilter) {
                    showRow = false;
                }
                
                // Sexe filter - FIXED: compare trimmed values
                if (sexeFilter !== 'all' && sexe.trim() !== sexeFilter) {
                    showRow = false;
                }
                
                // Education filter
                if (educationFilter !== 'all' && education !== educationFilter) {
                    showRow = false;
                }
                
                // Show or hide row
                if (showRow) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Update results count
            updateResultsCount(visibleCount, rows.length);
        }

        // Search applications (kept for compatibility)
        function searchApplications() {
            filterApplications();
        }

        // Reset all filters
        function resetFilters() {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('searchInput').value = '';
            
            if (document.getElementById('regionFilter')) document.getElementById('regionFilter').value = 'all';
            if (document.getElementById('ageFilter')) document.getElementById('ageFilter').value = 'all';
            if (document.getElementById('departmentFilter')) document.getElementById('departmentFilter').value = 'all';
            if (document.getElementById('workChoiceFilter')) document.getElementById('workChoiceFilter').value = 'all';
            if (document.getElementById('arabicFilter')) document.getElementById('arabicFilter').value = 'all';
            if (document.getElementById('frenchFilter')) document.getElementById('frenchFilter').value = 'all';
            if (document.getElementById('englishFilter')) document.getElementById('englishFilter').value = 'all';
            if (document.getElementById('sexeFilter')) document.getElementById('sexeFilter').value = 'all';
            if (document.getElementById('educationFilter')) document.getElementById('educationFilter').value = 'all';
            
            filterApplications();
        }

        // Update results count
        function updateResultsCount(visible, total) {
            const resultsCount = document.getElementById('resultsCount');
            if (resultsCount) {
                if (visible === total) {
                    resultsCount.textContent = `${total} candidat(s) au total`;
                } else {
                    resultsCount.textContent = `${visible} sur ${total} candidat(s)`;
                }
                resultsCount.style.color = visible < total ? '#667eea' : '#666';
                resultsCount.style.fontWeight = visible < total ? '600' : '400';
            }
        }

        // Initialize results count on page load
        document.addEventListener('DOMContentLoaded', function() {
            const rows = document.querySelectorAll('#applicationsTable tr');
            updateResultsCount(rows.length, rows.length);
        });

        // Auto-hide flash messages after 5 seconds
        setTimeout(() => {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(msg => {
                msg.style.opacity = '0';
                setTimeout(() => msg.remove(), 300);
            });
        }, 5000);
    </script>
</body>
</html>
