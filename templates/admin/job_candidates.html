<!DOCTYPE html>
<html lang="{% if lang == 'ar' %}ar{% else %}fr{% endif %}" {% if lang == 'ar' %}dir="rtl"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if lang == 'ar' %}المرشحون لـ: {{ job.titre if job.titre else job.title }}{% else %}Candidats pour {{ job.title }}{% endif %} - Admin Salsabil</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    {% if lang == 'ar' %}
    <style>
        body { direction: rtl; text-align: right; }
        .admin-sidebar { right: auto; left: 0; }
        .admin-main { margin-right: 0; margin-left: 280px; }
        .sidebar-nav .nav-item svg { margin-left: 12px; margin-right: 0; }
        .badge { margin-right: auto; margin-left: 8px; }
        .back-link svg { margin-left: 8px; margin-right: 0; }
        .admin-user svg { margin-left: 10px; margin-right: 0; }
        .job-info-card { text-align: right; }
        .job-meta .meta-item svg { margin-left: 8px; margin-right: 0; }
        .admin-table { text-align: right; }
        .candidate-info { flex-direction: row-reverse; }
        .candidate-avatar { margin-right: 0; margin-left: 12px; }
        .btn-view svg { margin-left: 8px; margin-right: 0; }
        .empty-state { text-align: center; }
    </style>
    {% endif %}
</head>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <img src="{{ url_for('static', filename='img/logo.jpeg') }}" alt="Logo Salsabil" class="logo-img">
                <h3>{% if lang == 'ar' %}لوحة الإدارة{% else %}Admin Panel{% endif %}</h3>
            </div>

            <nav class="sidebar-nav">
                <a href="{{ url_for('admin_dashboard_ar' if lang == 'ar' else 'admin_dashboard') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    {% if lang == 'ar' %}لوحة القيادة{% else %}Dashboard{% endif %}
                </a>
                <a href="{{ url_for('admin_jobs_ar' if lang == 'ar' else 'admin_jobs') }}" class="nav-item active">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                    </svg>
                    {% if lang == 'ar' %}عروض العمل{% else %}Offres d'emploi{% endif %}
                    <span class="badge">{{ jobs|length }}</span>
                </a>
                <a href="{{ url_for('admin_applications_ar' if lang == 'ar' else 'admin_applications') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <polyline points="17 11 19 13 23 9"></polyline>
                    </svg>
                    {% if lang == 'ar' %}الطلبات{% else %}Candidatures{% endif %}
                    {% if all_applications|length > 0 %}
                    <span class="badge">{{ all_applications|length }}</span>
                    {% endif %}
                </a>
                <a href="{{ url_for('admin_spontaneous_applications_ar' if lang == 'ar' else 'admin_spontaneous_applications') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <path d="M15 8h6m-3-3v6"></path>
                    </svg>
                    {% if lang == 'ar' %}الطلبات العفوية{% else %}Candidatures Spontanées{% endif %}
                    {% if spontaneous_count > 0 %}
                    <span class="badge">{{ spontaneous_count }}</span>
                    {% endif %}
                </a>
                {% if permissions and permissions.view_employees %}
                <a href="{{ url_for('admin_employees_ar' if lang == 'ar' else 'admin_employees') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    {% if lang == 'ar' %}الموظفون{% else %}Employés{% endif %}
                </a>
                {% endif %}
                <a href="{{ url_for('admin_profile_ar' if lang == 'ar' else 'admin_profile') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    {% if lang == 'ar' %}ملفي الشخصي{% else %}Mon Profil{% endif %}
                </a>
                <a href="{{ url_for('jobs_ar' if lang == 'ar' else 'jobs') }}" class="nav-item" target="_blank" rel="noopener noreferrer">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    {% if lang == 'ar' %}الموقع العام{% else %}Site Public{% endif %}
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="{{ url_for('admin_logout') }}" class="nav-item logout">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    {% if lang == 'ar' %}تسجيل الخروج{% else %}Déconnexion{% endif %}
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="admin-header">
                <div class="header-content">
                    <a href="{{ url_for('admin_jobs_ar' if lang == 'ar' else 'admin_jobs') }}" class="back-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        {% if lang == 'ar' %}العودة إلى العروض{% else %}Retour aux offres{% endif %}
                    </a>
                    <h1>{% if lang == 'ar' %}المرشحون لـ: {{ job.titre if job.titre else job.title }}{% else %}Candidats pour: {{ job.title }}{% endif %}</h1>
                </div>
                <div class="admin-user">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>{{ current_user.prenom if current_user else 'Admin' }} {{ current_user.nom if current_user else '' }}</span>
                    {% if current_user and current_user.role %}
                    <span class="user-role">({{ current_user.role|capitalize }})</span>
                    {% endif %}
                </div>
            </div>

            <!-- Job Info Card -->
            <div class="job-info-card">
                <div class="job-info-header">
                    <div>
                        <h2>{% if lang == 'ar' %}{{ job.titre if job.titre else job.title }}{% else %}{{ job.title }}{% endif %}</h2>
                        <div class="job-meta">
                            <span class="job-type-badge {{ job.type|lower }}">{% if lang == 'ar' %}{{ job.type_ar if job.type_ar else job.type }}{% else %}{{ job.type }}{% endif %}</span>
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                                {% if lang == 'ar' %}{{ job.lieu if job.lieu else job.location }}{% else %}{{ job.location }}{% endif %}
                            </span>
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                                </svg>
                                {% if lang == 'ar' %}{{ job.departement if job.departement else job.department }}{% else %}{{ job.department }}{% endif %}
                            </span>
                        </div>
                    </div>
                    <div class="candidates-stats">
                        <div class="stat-number">{{ applications|length }}</div>
                        <div class="stat-label">{% if lang == 'ar' %}{% if applications|length > 1 %}مرشحين{% else %}مرشح{% endif %}{% else %}Candidat{% if applications|length > 1 %}s{% endif %}{% endif %}</div>
                    </div>
                </div>
            </div>

            <!-- Candidates List -->
            <div class="content-section">
                {% if applications %}
                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>{% if lang == 'ar' %}المرشح{% else %}Candidat{% endif %}</th>
                                <th>{% if lang == 'ar' %}الاتصال{% else %}Contact{% endif %}</th>
                                <th>{% if lang == 'ar' %}تاريخ التقديم{% else %}Date de soumission{% endif %}</th>
                                <th>{% if lang == 'ar' %}الحالة{% else %}Statut{% endif %}</th>
                                <th>{% if lang == 'ar' %}الإجراءات{% else %}Actions{% endif %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for app in applications %}
                            <tr>
                                <td>
                                    <div class="candidate-info">
                                        <div class="candidate-avatar">
                                            {{ app.prenom[0] }}{{ app.nom[0] }}
                                        </div>
                                        <div>
                                            <div class="candidate-name">{{ app.prenom }} {{ app.nom }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="contact-info">
                                        <div>{{ app.email }}</div>
                                        <div class="candidate-phone">{{ app.telephone }}</div>
                                    </div>
                                </td>
                                <td>{{ app.date_soumission }}</td>
                                <td>
                                    <span class="status-badge status-{{ app.status.replace(' ', '-') }}">
                                        {{ app.status }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{{ url_for('admin_application_detail_ar' if lang == 'ar' else 'admin_application_detail', app_id=app.id) }}" class="btn-view">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                        {% if lang == 'ar' %}عرض التفاصيل{% else %}Voir détails{% endif %}
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <line x1="23" y1="11" x2="17" y2="11"></line>
                    </svg>
                    <h3>{% if lang == 'ar' %}لا يوجد مرشحون لهذا المنصب{% else %}Aucun candidat pour ce poste{% endif %}</h3>
                    <p>{% if lang == 'ar' %}ستظهر الطلبات هنا بمجرد تقديمها.{% else %}Les candidatures apparaîtront ici dès qu'elles seront soumises.{% endif %}</p>
                </div>
                {% endif %}
            </div>
        </main>
    </div>
</body>
</html>
